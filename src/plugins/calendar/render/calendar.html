{% extends "plugin.html" %}

{% block content %}
<!-- Calendar Container -->
<div id="calendar" class="calendar" style="
  --fc-page-bg-color: #fff;
  --fc-border-color: #000;
  --fc-today-bg-color: #fff;
  --fc-small-font-size: {{ 0.9 * font_scale }}em;
  --fc-title-font-size: {{ 2 * font_scale }}em;
  --fc-table-font-size: {{ 1.1 * font_scale }}em;
"></div>

<!-- Calendar Script -->
<script src="{{static_dir}}/scripts/calendar.min.js" charset="UTF-8"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rawEvents = {{ events | tojson }};

    // Pastel Google Calendar-style colors
    const pastelColors = [
      '#a6cee3', '#1f78b4', '#b2df8a', '#33a02c',
      '#fb9a99', '#e31a1c', '#fdbf6f', '#ff7f00',
      '#cab2d6', '#6a3d9a', '#ffff99', '#b15928'
    ];

    // Assign a random color to each event
    const events = rawEvents.map(event => {
      const color = pastelColors[Math.floor(Math.random() * pastelColors.length)];
      return {
        ...event,
        backgroundColor: color,
        borderColor: color,
        textColor: '#000'  // ensures text is readable
      };
    });

    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: events,
      now: '{{ current_dt }}',
      timeZone: '{{ timezone }}',
      locale: "{{ plugin_settings.language or 'en' }}",
      firstDay: "{{ plugin_settings.weekStartDay or 0 }}",
      headerToolbar: {
        left: '',
        center: "{{ 'title' if plugin_settings.displayTitle == 'true' else '' }}",
        right: ''
      },
      fixedWeekCount: false,
      weekends: {{ (plugin_settings.displayWeekends == "true") | tojson }},
    displayEventTime: false,
      nowIndicator: false,
      height: '100%',
      dayMaxEvents: 3
  });

    calendar.render();
  });
</script>

{% endblock %}
