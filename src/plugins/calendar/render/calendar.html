{% extends "plugin.html" %}

{% block content %}

<script src="{{static_dir}}/scripts/calendar.min.js" charset="UTF-8"></script>

<div id="calendar" class="calendar" style="
--fc-page-bg-color: #fff;
--fc-border-color: #000;
--fc-today-bg-color: #fff;
--fc-event-bg-color: #000;
--fc-event-color: #fff;
--fc-small-font-size: {{ 0.9 * font_scale }}em;
--fc-title-font-size: {{ 2 * font_scale }}em;
--fc-table-font-size: {{ 1.1 * font_scale }}em;
"></div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const rawEvents = {{ events | tojson }};

    // Pastel Google Calendar-like color palette
    const pastelColors = [
      '#a6cee3', // light blue
      '#1f78b4', // blue
      '#b2df8a', // light green
      '#33a02c', // green
      '#fb9a99', // light red
      '#e31a1c', // red
      '#fdbf6f', // orange
      '#ff7f00', // dark orange
      '#cab2d6', // lavender
      '#6a3d9a', // purple
      '#ffff99', // yellow
      '#b15928'  // brown
    ];

    // Assign a random color to each event
    const events = rawEvents.map(event => {
      const color = pastelColors[Math.floor(Math.random() * pastelColors.length)];
      return {
        ...event,
        backgroundColor: color,
        borderColor: color,
        textColor: '#000'  // ensures text is readable on pastel backgrounds
      };
    });

    const calendarEl = document.getElementById('calendar');

    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: events,
      now: '{{ current_dt }}',
      timeZone: '{{ timezone }}',
      locale: "{{ plugin_settings.language or 'en' }}",
      firstDay: "{{ plugin_settings.weekStartDay or 0 }}",
      headerToolbar: {
        left: '',
        center: "{{ 'title' if plugin_settings.displayTitle == 'true' else '' }}",
        right: ''
      },
      fixedWeekCount: false,
      weekends: {{ (plugin_settings.displayWeekends == "true") | tojson }},
    displayEventTime: false,
      nowIndicator: false,
      height: '100%',
      dayMaxEvents: 3
  });

    calendar.render();
  });
</script>

{% endblock %}
